<!DOCTYPE html>
<html lang="sr">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Admin ‚Äì Meƒçevi</title>
      <script type="module" src="firebase.mjs"></script>
      <style>
         * {
         box-sizing: border-box;
         margin: 0;
         padding: 0;
         }
         body {
         font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
         background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
         min-height: 100vh;
         padding: 20px 10px;
         }
         .container {
         max-width: 800px;
         margin: 0 auto;
         }
         /* HEADER */
         header {
         background: white;
         border-radius: 16px;
         padding: 20px 30px;
         margin-bottom: 20px;
         box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
         display: flex;
         justify-content: space-between;
         align-items: center;
         flex-wrap: wrap;
         gap: 15px;
         }
         .logo {
         font-size: 24px;
         font-weight: bold;
         background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
         -webkit-background-clip: text;
         -webkit-text-fill-color: transparent;
         background-clip: text;
         }
         .nav-buttons {
         display: flex;
         gap: 10px;
         }
         .nav-btn {
         padding: 10px 20px;
         border: none;
         border-radius: 10px;
         font-size: 14px;
         font-weight: 600;
         cursor: pointer;
         transition: all 0.3s ease;
         background: #f0f0f0;
         color: #333;
         }
         .nav-btn:hover {
         background: #e0e0e0;
         transform: translateY(-2px);
         }
         .nav-btn.active {
         background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
         color: white;
         box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
         }
         .nav-btn.logout {
         background: #ff4757;
         color: white;
         }
         .nav-btn.logout:hover {
         background: #ee5a6f;
         }
         /* MAIN CARD */
         .card {
         background: white;
         border-radius: 16px;
         padding: 30px;
         margin-bottom: 20px;
         box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
         }
         .card-title {
         font-size: 22px;
         font-weight: 700;
         margin-bottom: 25px;
         color: #2d3436;
         text-align: center;
         }
         /* FORM STYLING */
         .form-group {
         margin-bottom: 20px;
         }
         .form-label {
         display: block;
         font-size: 13px;
         font-weight: 600;
         color: #636e72;
         margin-bottom: 8px;
         text-transform: uppercase;
         letter-spacing: 0.5px;
         }
         input, textarea {
         width: 100%;
         padding: 14px 16px;
         border: 2px solid #e0e0e0;
         border-radius: 10px;
         font-size: 15px;
         transition: all 0.3s ease;
         font-family: inherit;
         }
         input:focus, textarea:focus {
         outline: none;
         border-color: #667eea;
         box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
         }
         textarea {
         min-height: 100px;
         resize: vertical;
         }
         .input-row {
         display: grid;
         grid-template-columns: 1fr 1fr;
         gap: 15px;
         }
         .input-row-3 {
         display: grid;
         grid-template-columns: 1fr 1fr 1fr;
         gap: 15px;
         }
         /* SECTION HEADERS */
         .section-header {
         display: flex;
         align-items: center;
         gap: 10px;
         margin: 30px 0 15px;
         padding-bottom: 10px;
         border-bottom: 2px solid #f0f0f0;
         }
         .section-icon {
         width: 32px;
         height: 32px;
         border-radius: 8px;
         display: flex;
         align-items: center;
         justify-content: center;
         font-size: 18px;
         }
         .section-icon.red {
         background: #ffe5e5;
         color: #d63031;
         }
         .section-icon.blue {
         background: #e5f0ff;
         color: #0984e3;
         }
         .section-title {
         font-size: 18px;
         font-weight: 700;
         color: #2d3436;
         }
         /* PLAYER BUTTONS */
         .players-grid {
         display: flex;
         flex-wrap: wrap;
         gap: 8px;
         margin-bottom: 20px;
         }
         .player-btn {
         padding: 10px 16px;
         border: 2px solid #e0e0e0;
         border-radius: 10px;
         background: white;
         cursor: pointer;
         font-size: 14px;
         font-weight: 500;
         transition: all 0.2s ease;
         user-select: none;
         }
         .player-btn:hover {
         border-color: #b2bec3;
         transform: translateY(-2px);
         box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
         }
         .player-btn.active {
         font-weight: 700;
         color: white;
         border: 2px solid transparent;
         }
         #playedRed .player-btn.active,
         #scorersRedPlayers .player-btn.active {
         background: linear-gradient(135deg, #d63031 0%, #e17055 100%);
         box-shadow: 0 4px 15px rgba(214, 48, 49, 0.3);
         }
         #playedBlue .player-btn.active,
         #scorersBluePlayers .player-btn.active {
         background: linear-gradient(135deg, #0984e3 0%, #00b894 100%);
         box-shadow: 0 4px 15px rgba(9, 132, 227, 0.3);
         }
         /* BADGES */
         .captain-badge {
         display: inline-block;
         background: linear-gradient(135deg, #ffd700, #ffed4e);
         color: #333;
         font-weight: bold;
         padding: 2px 6px;
         border-radius: 4px;
         margin-left: 6px;
         font-size: 10px;
         box-shadow: 0 2px 4px rgba(0,0,0,0.15);
         }
         .goalkeeper-badge {
         margin-left: 6px;
         font-size: 16px;
         }
         /* SCORER TAGS */
         .scorers-tags {
         display: flex;
         flex-wrap: wrap;
         gap: 8px;
         margin-top: 10px;
         }
         .tag {
         background: #f0f0f0;
         padding: 8px 12px;
         border-radius: 8px;
         display: flex;
         align-items: center;
         gap: 10px;
         font-size: 14px;
         font-weight: 500;
         }
         .tag button {
         width: 22px;
         height: 22px;
         border: none;
         border-radius: 50%;
         background: #ff4757;
         color: white;
         cursor: pointer;
         display: flex;
         align-items: center;
         justify-content: center;
         font-size: 16px;
         line-height: 1;
         transition: all 0.2s ease;
         }
         .tag button:hover {
         background: #ee5a6f;
         transform: scale(1.1);
         }
         /* ACTION BUTTONS */
         .btn {
         width: 100%;
         padding: 16px;
         border: none;
         border-radius: 12px;
         font-size: 16px;
         font-weight: 700;
         cursor: pointer;
         transition: all 0.3s ease;
         margin-top: 15px;
         text-transform: uppercase;
         letter-spacing: 0.5px;
         }
         .btn-primary {
         background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
         color: white;
         box-shadow: 0 4px 15px rgba(0, 184, 148, 0.3);
         }
         .btn-primary:hover {
         box-shadow: 0 6px 20px rgba(0, 184, 148, 0.4);
         transform: translateY(-2px);
         }
         .btn-warning {
         background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
         color: white;
         display: none;
         box-shadow: 0 4px 15px rgba(253, 203, 110, 0.3);
         }
         .btn-secondary {
         background: #636e72;
         color: white;
         display: none;
         }
         .btn-secondary:hover {
         background: #4a5558;
         }
         /* MATCHES TABLE */
         .table-wrapper {
         overflow-x: auto;
         margin-top: 25px;
         border-radius: 12px;
         border: 2px solid #f0f0f0;
         }
         table {
         width: 100%;
         border-collapse: collapse;
         min-width: 600px;
         }
         th {
         background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
         padding: 15px 12px;
         text-align: left;
         font-size: 13px;
         font-weight: 700;
         color: #636e72;
         text-transform: uppercase;
         letter-spacing: 0.5px;
         border-bottom: 2px solid #e0e0e0;
         }
         td {
         padding: 15px 12px;
         border-bottom: 1px solid #f0f0f0;
         font-size: 14px;
         color: #2d3436;
         }
         tr:hover {
         background: #f8f9fa;
         }
         .table-btn {
         padding: 8px 14px;
         border: none;
         border-radius: 8px;
         font-size: 12px;
         font-weight: 600;
         cursor: pointer;
         transition: all 0.2s ease;
         margin-right: 6px;
         }
         .table-btn.edit {
         background: #667eea;
         color: white;
         }
         .table-btn.edit:hover {
         background: #5568d3;
         transform: scale(1.05);
         }
         .table-btn.delete {
         background: #ff4757;
         color: white;
         }
         .table-btn.delete:hover {
         background: #ee5a6f;
         transform: scale(1.05);
         }
         /* MOBILE RESPONSIVE */
         @media (max-width: 768px) {
         body {
         padding: 10px 5px;
         }
         .container {
         max-width: 100%;
         }
         header {
         padding: 15px 20px;
         border-radius: 12px;
         flex-direction: column;
         align-items: stretch;
         }
         .logo {
         text-align: center;
         font-size: 20px;
         }
         .nav-buttons {
         flex-direction: column;
         }
         .nav-btn {
         width: 100%;
         text-align: center;
         }
         .card {
         padding: 20px;
         border-radius: 12px;
         }
         .card-title {
         font-size: 20px;
         }
         .input-row {
         grid-template-columns: 1fr;
         }
         .team-title {
         font-size: 20px;
         margin: 20px 0 12px;
         }
         table {
         min-width: 450px;
         }
         th, td {
         padding: 8px 4px;
         font-size: 11px;
         }
         th {
         padding: 10px 6px;
         }
         .edit-btn, .del-btn {
         padding: 6px 10px;
         font-size: 10px;
         display: block;
         width: 100%;
         margin: 2px 0;
         }
         #modalBox {
         padding: 20px;
         width: 95%;
         }
         .modal-buttons {
         flex-direction: column;
         }
         }
         @media (max-width: 480px) {
         .card {
         padding: 15px;
         }
         .team-title {
         font-size: 18px;
         }
         table {
         min-width: 400px;
         }
         th, td {
         padding: 6px 2px;
         font-size: 10px;
         }
         th {
         padding: 8px 4px;
         }
         .edit-btn, .del-btn {
         padding: 5px 8px;
         font-size: 9px;
         }
         .captain-badge {
         font-size: 8px;
         padding: 1px 4px;
         }
         .goalkeeper-badge {
         font-size: 14px;
         }
         }
      </style>
   </head>
   <body>
      <div class="container">
         <!-- HEADER -->
         <header>
            <div class="logo">‚öΩ Admin Panel</div>
            <div class="nav-buttons">
               <button class="nav-btn active" onclick="window.location.href='admin.html'">Meƒçevi</button>
               <button class="nav-btn" onclick="window.location.href='admin-igraci.html'">Igraƒçi</button>
               <button class="nav-btn logout" onclick="logout()">Logout</button>
            </div>
         </header>
         <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
            import { getAuth, onAuthStateChanged, signOut }
              from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
            
            const firebaseConfig = {
              apiKey: "AIzaSyB9C173giGVH0gt_x4W8f-hoJldHXyRfqo",
              authDomain: "termin-rezultati.firebaseapp.com",
              databaseURL: "https://termin-rezultati-default-rtdb.europe-west1.firebasedatabase.app",
              projectId: "termin-rezultati",
              storageBucket: "termin-rezultati.appspot.com",
              messagingSenderId: "263582756600",
              appId: "1:263582756600:web:d40d40c474340122d4950d"
            };
            
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            
            /* üîí ADMIN GUARD */
            onAuthStateChanged(auth, user => {
              if (!user) {
                window.location.href = "login.html";
              } else {
                console.log("ADMIN OK:", user.email);
              }
            });
            
            /* LOGOUT */
            window.logout = function () {
              signOut(auth).then(() => {
                window.location.href = "index.html";
              });
            };
         </script>
         <!-- MAIN FORM CARD -->
         <div class="card">
            <h1 class="card-title">Upravljanje meƒçevima</h1>
            <div class="form-group">
               <label class="form-label">Kolo</label>
               <input id="round" type="number" placeholder="Unesite broj kola">
            </div>
            <div class="input-row">
               <div class="form-group">
                  <label class="form-label">Datum</label>
                  <input id="date" type="date">
               </div>
               <div class="form-group">
                  <label class="form-label">Vreme</label>
                  <input id="time" type="time">
               </div>
            </div>
            <div class="input-row">
               <div class="form-group">
                  <label class="form-label">Golovi Crveni</label>
                  <input id="red" type="number" placeholder="0">
               </div>
               <div class="form-group">
                  <label class="form-label">Golovi Plavi</label>
                  <input id="blue" type="number" placeholder="0">
               </div>
            </div>
            <div class="form-group">
               <label class="form-label">Info o meƒçu</label>
               <textarea id="info" placeholder="Dodajte dodatne informacije o meƒçu..."></textarea>
            </div>
            <!-- IGRALI CRVENI -->
            <div class="section-header">
               <div class="section-icon red">üë•</div>
               <div class="section-title">Igrali ‚Äì Crveni</div>
            </div>
            <div class="players-grid" id="playedRed"></div>
            <!-- STRELCI CRVENI -->
            <div class="section-header">
               <div class="section-icon red">‚öΩ</div>
               <div class="section-title">Strelci ‚Äì Crveni</div>
            </div>
            <div class="players-grid" id="scorersRedPlayers"></div>
            <div class="scorers-tags" id="scorersRedTags"></div>
            <!-- IGRALI PLAVI -->
            <div class="section-header">
               <div class="section-icon blue">üë•</div>
               <div class="section-title">Igrali ‚Äì Plavi</div>
            </div>
            <div class="players-grid" id="playedBlue"></div>
            <!-- STRELCI PLAVI -->
            <div class="section-header">
               <div class="section-icon blue">‚öΩ</div>
               <div class="section-title">Strelci ‚Äì Plavi</div>
            </div>
            <div class="players-grid" id="scorersBluePlayers"></div>
            <div class="scorers-tags" id="scorersBlueTags"></div>
            <!-- ACTION BUTTONS -->
            <button class="btn btn-primary" id="saveBtn">Saƒçuvaj meƒç</button>
            <button class="btn btn-warning" id="updateBtn">Saƒçuvaj izmene</button>
            <button class="btn btn-secondary" id="cancelBtn" onclick="clearForm()">Otka≈æi izmenu</button>
         </div>
         <!-- MATCHES LIST CARD -->
         <div class="card">
            <h2 class="card-title">Lista meƒçeva</h2>
            <div class="table-wrapper">
               <table>
                  <thead>
                     <tr>
                        <th>Kolo</th>
                        <th>Rezultat</th>
                        <th>Datum</th>
                        <th>Akcije</th>
                     </tr>
                  </thead>
                  <tbody id="matchList"></tbody>
               </table>
            </div>
         </div>
      </div>
      <!-- SCRIPT -->
      <script type="module">
         import { onValue, push, update, remove, get }
           from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";
         
         let players = { crveni:{}, plavi:{} };
         let scorers = [];
         let editingId = null;
         let pendingPlayed = null;
         
         /* FORMAT PLAYER NAME */
         function formatPlayerName(name) {
           if (!name) return '';
           let displayName = name;
           let badges = '';
         
           const captainRegex = /\s*\(c\)\s*/i;
           if (captainRegex.test(name)) {
             displayName = name.replace(captainRegex, ' ').trim();
             badges += '<span class="captain-badge">C</span>';
           }
         
           const goalkeeperRegex = /\s*\(g\)\s*/i;
           if (goalkeeperRegex.test(name)) {
             displayName = name.replace(goalkeeperRegex, ' ').trim();
             badges += '<span class="goalkeeper-badge">üß§</span>';
           }
         
           return displayName + badges;
         }
         
         /* LOAD PLAYERS */
         onValue(window.dbRef("players"), snap => {
           players = snap.val() || { crveni:{}, plavi:{} };
           renderPlayers();
           if (pendingPlayed) applyPlayedSelection(pendingPlayed);
         });
         
         /* RENDER PLAYERS */
         function renderPlayers() {
           const PR = document.getElementById("playedRed");
           const PB = document.getElementById("playedBlue");
           const SRP = document.getElementById("scorersRedPlayers");
           const SBP = document.getElementById("scorersBluePlayers");
         
           PR.innerHTML = PB.innerHTML = SRP.innerHTML = SBP.innerHTML = "";
         
           Object.entries(players.crveni).forEach(([id, p]) => {
             PR.innerHTML  += `<div class="player-btn" data-id="${id}" data-team="crveni">${formatPlayerName(p.name)}</div>`;
             SRP.innerHTML += `<div class="player-btn" data-id="${id}" data-team="crveni">${formatPlayerName(p.name)}</div>`;
           });
         
           Object.entries(players.plavi).forEach(([id, p]) => {
             PB.innerHTML  += `<div class="player-btn" data-id="${id}" data-team="plavi">${formatPlayerName(p.name)}</div>`;
             SBP.innerHTML += `<div class="player-btn" data-id="${id}" data-team="plavi">${formatPlayerName(p.name)}</div>`;
           });
         
           if (pendingPlayed) applyPlayedSelection(pendingPlayed);
         }
         
         /* APPLY PLAYED SELECTION */
         function applyPlayedSelection(played) {
           document.querySelectorAll("#playedRed .player-btn, #playedBlue .player-btn")
             .forEach(b => b.classList.remove("active"));
         
           Object.entries(played || {}).forEach(([playerId, team]) => {
             const container = team === "crveni" ? "#playedRed" : "#playedBlue";
             const btn = document.querySelector(`${container} .player-btn[data-id="${playerId}"]`);
             if (btn) btn.classList.add("active");
           });
         }
         
         /* EVENT DELEGATION */
         (function setupEventDelegation() {
           document.getElementById("playedRed").addEventListener("click", (e) => {
             if (e.target.classList.contains("player-btn")) {
               e.target.classList.toggle("active");
               pendingPlayed = getPlayed();
             }
           });
         
           document.getElementById("playedBlue").addEventListener("click", (e) => {
             if (e.target.classList.contains("player-btn")) {
               e.target.classList.toggle("active");
               pendingPlayed = getPlayed();
             }
           });
         
           document.getElementById("scorersRedPlayers").addEventListener("click", (e) => {
             if (e.target.classList.contains("player-btn")) {
               scorers.push({ id: e.target.dataset.id, team: e.target.dataset.team });
               refreshTags();
             }
           });
         
           document.getElementById("scorersBluePlayers").addEventListener("click", (e) => {
             if (e.target.classList.contains("player-btn")) {
               scorers.push({ id: e.target.dataset.id, team: e.target.dataset.team });
               refreshTags();
             }
           });
         })();
         
         /* REFRESH TAGS */
         function refreshTags(){
           document.getElementById("scorersRedTags").innerHTML = "";
           document.getElementById("scorersBlueTags").innerHTML = "";
         
           scorers.forEach((s,i)=>{
             const rawName = players[s.team][s.id]?.name || "(obrisan)";
             const name = rawName.replace(/\s*\(c\)\s*/gi, '').replace(/\s*\(g\)\s*/gi, '').trim();
             const tag = `<div class="tag">${name}<button onclick="removeGoal(${i})">√ó</button></div>`;
             if (s.team==="crveni")
               document.getElementById("scorersRedTags").innerHTML += tag;
             else
               document.getElementById("scorersBlueTags").innerHTML += tag;
           });
         
           autoSetGoals();
         }
         
         window.removeGoal = i => { scorers.splice(i,1); refreshTags(); };
         
         function autoSetGoals() {
           red.value = scorers.filter(s => s.team === "crveni").length;
           blue.value = scorers.filter(s => s.team === "plavi").length;
         }
         
         /* GET PLAYED */
         function getPlayed() {
           const played = {};
           document.querySelectorAll("#playedRed .active,#playedBlue .active")
             .forEach(btn => played[btn.dataset.id] = btn.dataset.team);
           return played;
         }
         
         /* VALIDATE */
         function validate(){
           const e=[];
           if(!round.value) e.push("Kolo?");
           if(!date.value)  e.push("Datum?");
           if(!time.value)  e.push("Vreme?");
           if(!info.value.trim()) e.push("Info?");
           if(Object.keys(getPlayed()).length===0) e.push("Igrali?");
           if(scorers.length===0)  e.push("Strelci?");
         
           if(e.length){
             alert("Gre≈°ke:\n\n"+e.join("\n"));
             return false;
           }
           return true;
         }
         
         /* UPDATE STATS */
         async function updateOne(team,id,field,delta){
           const ref = window.dbRef(`players/${team}/${id}`);
           const snap = await get(ref);
           if (!snap.exists()) return;
         
           const p = snap.val();
           const next = Math.max(0, (p[field]||0) + delta);
           await update(ref, { [field]: next });
         }
         
         async function applyStats(match, dir) {
           const played = Object.entries(match.played || {});
           const scor = match.scorers || [];
         
           for (const [id, team] of played) {
             await updateOne(team, id, "matches", dir);
           }
         
           for (const s of scor) {
             await updateOne(s.team, s.id, "goals", dir);
           }
         }
         
         /* SAVE MATCH */
         saveBtn.onclick = async () =>{
           if(!validate()) return;
         
           const match = {
             round:round.value,
             date:date.value,
             time:time.value,
             red:+red.value,
             blue:+blue.value,
             info:info.value.trim(),
             played:getPlayed(),
             scorers: JSON.parse(JSON.stringify(scorers)),
             timestamp:Date.now()
           };
         
           await push(window.dbRef("matches"), match);
           await applyStats(match, +1);
           clearForm();
         };
         
         /* UPDATE MATCH */
         updateBtn.onclick = async () => {
           if(!validate()) return;
         
           const oldSnap = await get(window.dbRef(`matches/${editingId}`));
           const oldMatch = oldSnap.val();
           await applyStats(oldMatch, -1);
         
           const newMatch = {
             round:round.value,
             date:date.value,
             time:time.value,
             red:+red.value,
             blue:+blue.value,
             info:info.value.trim(),
             played:getPlayed(),
             scorers: JSON.parse(JSON.stringify(scorers)),
             timestamp: oldMatch.timestamp
           };
         
           await update(window.dbRef(`matches/${editingId}`), newMatch);
           await applyStats(newMatch, +1);
           clearForm();
         };
         
         /* DELETE MATCH */
         window.deleteMatch = async id => {
           if (!confirm("Obrisati meƒç?")) return;
         
           const snap = await get(window.dbRef(`matches/${id}`));
           await applyStats(snap.val(), -1);
           await remove(window.dbRef(`matches/${id}`));
         };
         
         /* FORMAT DATE */
         function formatDateForInput(date) {
           const year = date.getFullYear();
           const month = String(date.getMonth() + 1).padStart(2, '0');
           const day = String(date.getDate()).padStart(2, '0');
           return `${year}-${month}-${day}`;
         }
         
         /* CLEAR FORM */
         window.clearForm = function(){
           editingId = null;
           scorers = [];
           pendingPlayed = null;
         
           round.value = "";
           red.value = "";
           blue.value = "";
           info.value = "";
           autoFillRound();
         
           document.querySelectorAll(".player-btn.active").forEach(b => b.classList.remove("active"));
           refreshTags();
         
           const d = getNextThursday();
           date.value = formatDateForInput(d);
           time.value = "18:00";
         
           saveBtn.style.display = "block";
           updateBtn.style.display = "none";
           cancelBtn.style.display = "none";
         };
         
         /* LIST MATCHES */
         onValue(window.dbRef("matches"), snap=>{
           const tbody=document.getElementById("matchList");
           tbody.innerHTML="";
         
           Object.entries(snap.val()||{})
             .sort((a,b)=>b[1].timestamp-a[1].timestamp)
             .forEach(([id,m])=>{
               tbody.innerHTML+=`
                 <tr>
                   <td><strong>${m.round}</strong></td>
                   <td>Crveni <strong>${m.red}</strong> - <strong>${m.blue}</strong> Plavi</td>
                   <td>${m.date} ${m.time}</td>
                   <td>
                     <button class="table-btn edit" onclick="editMatch('${id}')">Izmeni</button>
                     <button class="table-btn delete" onclick="deleteMatch('${id}')">Obri≈°i</button>
                   </td>
                 </tr>`;
             });
         });
         
         /* EDIT MATCH */
         window.editMatch = async matchId => {
           editingId = matchId;
         
           const snap = await get(window.dbRef(`matches/${matchId}`));
           const m = snap.val();
         
           round.value = m.round;
           date.value = m.date;
           time.value = m.time;
           red.value = m.red;
           blue.value = m.blue;
           info.value = m.info;
         
           scorers = [...m.scorers];
           refreshTags();
         
           pendingPlayed = m.played || {};
           applyPlayedSelection(pendingPlayed);
         
           saveBtn.style.display = "none";
           updateBtn.style.display = "block";
           cancelBtn.style.display = "block";
         
           window.scrollTo({ top: 0, behavior: 'smooth' });
         };
         
         /* AUTO THURSDAY */
         function getNextThursday() {
           const now = new Date();
           let diff = (4 - now.getDay() + 7) % 7;
           if (diff === 0) diff = 7;
           const d = new Date();
           d.setDate(now.getDate() + diff);
           return d;
         }
         
         (function(){
           const d = getNextThursday();
           date.value = formatDateForInput(d);
           time.value = "18:00";
           autoFillRound();
         })();
         
         /* AUTO ROUND */
         function autoFillRound() {
           onValue(window.dbRef("matches"), snap => {
             const data = snap.val() || {};
             const rounds = Object.values(data).map(m => Number(m.round) || 0);
             const nextRound = (rounds.length ? Math.max(...rounds) + 1 : 1);
             round.value = nextRound;
           }, { onlyOnce: true });
         }
         
      </script>
   </body>
</html>
