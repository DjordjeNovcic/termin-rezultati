<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8">
  <title>Admin – Rezultati</title>
  <script type="module" src="firebase.mjs"></script>
  <style>
    body { font-family: Arial; max-width: 450px; margin: 20px auto; }
    input, button { width: 100%; padding: 12px; margin: 8px 0; font-size: 16px; }
    h2 { margin-bottom: 5px; }
  </style>
</head>
<body>

<h2>Dodaj rezultat (Crveni vs Plavi)</h2>
<button onclick="logout()">Logout</button>

<label>Kolo:</label>
<input id="round" type="number" placeholder="Broj kola">

<label>Datum:</label>
<input id="matchDate" type="date">

<label>Vreme:</label>
<input id="matchTime" type="time">

<label>Golovi – Crveni:</label>
<input id="red" type="number" placeholder="Crveni">

<label>Golovi – Plavi:</label>
<input id="blue" type="number" placeholder="Plavi">

<button onclick="saveMatch()">Sačuvaj rezultat</button>

<script type="module">
  if (!localStorage.getItem("admin")) {
    window.location.href = "login.html";
  }

  import { onValue } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

  // automatski predloži sledeće kolo
  const refMatches = window.dbRef("matches");
  let latestRound = 0;

  onValue(refMatches, snap => {
    const data = snap.val() || {};
    const list = Object.values(data);

    if (list.length > 0) {
      const maxRound = Math.max(...list.map(m => m.round || 0));
      latestRound = maxRound + 1;
    } else {
      latestRound = 1;
    }

    document.getElementById("round").value = latestRound;
  });

  function saveMatch() {
    const round = Number(document.getElementById("round").value);
    const date = document.getElementById("matchDate").value;
    const time = document.getElementById("matchTime").value;
    const red = Number(document.getElementById("red").value);
    const blue = Number(document.getElementById("blue").value);

    if (!round || !date || !time || isNaN(red) || isNaN(blue)) {
      alert("Popuni sva polja!");
      return;
    }

    window.pushTo("matches", {
      round,
      date,
      time,
      red,
      blue,
      timestamp: Date.now()
    });

    alert("Sačuvano!");

    // reset polja
    document.getElementById("matchTime").value = "";
    document.getElementById("red").value = "";
    document.getElementById("blue").value = "";
  }

  window.logout = () => {
    localStorage.removeItem("admin");
    window.location.href = "login.html";
  };
</script>

</body>
</html>
