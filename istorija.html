<!DOCTYPE html>
<html lang="sr">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Istorija utakmica</title>
      <script type="module" src="firebase.mjs"></script>
      <style>
         * {
         box-sizing: border-box;
         margin: 0;
         padding: 0;
         }
         body {
         font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
         background: linear-gradient(180deg, #f5f7fb 0%, #eef1f7 100%);
         min-height: 100vh;
         padding: 20px;
         }
         .logo {
         font-size: 22px;
         font-weight: 600;
         color: #6c72e6;
         display: flex;
         align-items: center;
         gap: 10px;
         }
         .link-back {
         display: inline-block;
         color: white;
         text-decoration: none;
         font-size: 16px;
         font-weight: 500;
         padding: 10px 20px;
         background: rgba(255, 255, 255, 0.2);
         border-radius: 10px;
         transition: all 0.3s ease;
         backdrop-filter: blur(10px);
         }
         .link-back:hover {
         background: rgba(255, 255, 255, 0.3);
         transform: translateX(-3px);
         }
         .container {
         max-width: 900px;
         margin: 0 auto;
         }
         h1 {
         color: #4b5be7;
         margin-bottom: 28px;
         font-size: 32px;
         text-align: center;
         font-weight: 700;
         }
         /* Back button at top */
         .back-button-top {
         display: flex;
         justify-content: flex-start;
         margin-bottom: 30px;
         }
         .back-btn {
         background: transparent;
         border: none;
         color: #4b5be7;
         padding: 6px 0;
         font-weight: 600;
         }
         .back-btn:hover {
         text-decoration: underline;
         transform: none;
         }
         .back-btn:active {
         transform: translateY(0);
         }
         #historyList {
         animation: fadeIn 0.5s ease-in;
         }
         @keyframes fadeIn {
         from { opacity: 0; transform: translateY(20px); }
         to { opacity: 1; transform: translateY(0); }
         }
         .match-box {
         background: white;
         padding: 25px;
         border-radius: 16px;
         margin-bottom: 20px;
         box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
         transition: transform 0.3s ease, box-shadow 0.3s ease;
         }
         .match-box:hover {
         transform: translateY(-4px);
         box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
         }
         .match-meta {
         color: #666;
         margin-bottom: 15px;
         font-size: 14px;
         font-weight: 500;
         display: flex;
         justify-content: space-between;
         align-items: center;
         flex-wrap: wrap;
         gap: 10px;
         }
         .match-links {
         display: flex;
         gap: 12px;
         flex-wrap: wrap;
         }
         .info-link {
         color: #667eea;
         cursor: pointer;
         font-size: 14px;
         text-decoration: none;
         font-weight: 500;
         padding: 6px 12px;
         background: #f0f0ff;
         border-radius: 8px;
         transition: all 0.2s ease;
         display: inline-flex;
         align-items: center;
         gap: 4px;
         }
         .info-link:hover {
         background: #667eea;
         color: white;
         transform: translateY(-2px);
         box-shadow: 0 0 0 2px rgba(75, 91, 231, 0.15);
         }
         .match-teams {
         display: flex;
         justify-content: space-around;
         align-items: center;
         margin-top: 15px;
         }
         .team-logo {
         width: 130px;
         height: 130px;
         object-fit: contain;
         padding: 10px;
         border-radius: 14px;
         background: transparent;
         box-shadow: none;
         transition: transform 0.3s ease;
         }
         .team-logo:hover {
         transform: scale(1.1);
         }
         .team-name {
         font-weight: 600;
         font-size: 15px;
         margin-top: 8px;
         }
         .score {
         font-size: 40px;
         font-weight: 800;
         margin: 10px 0;
         background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
         -webkit-background-clip: text;
         -webkit-text-fill-color: transparent;
         background-clip: text;
         letter-spacing: 1px;
         min-width: 120px;
         text-align: center;
         }
         /* Captain and Goalkeeper badges */
         .captain-badge {
         display: inline-block;
         background: linear-gradient(135deg, #ffd700, #ffed4e);
         color: #333;
         font-weight: bold;
         padding: 3px 7px;
         border-radius: 5px;
         margin-left: 8px;
         font-size: 11px;
         box-shadow: 0 2px 6px rgba(0,0,0,0.15);
         border: 1px solid #daa520;
         }
         .goalkeeper-badge {
         margin-left: 8px;
         font-size: 18px;
         }
         .scorer-item {
         display: flex;
         align-items: center;
         justify-content: space-between;
         padding: 5px 8px;     /* +1px vertikalno */
         margin: 2px 0;       /* +1px izmeƒëu redova */
         font-size: 13px;
         font-weight: 500;
         line-height: 1.15;   /* mrvicu rastereƒáenje */
         border-radius: 4px;
         }
         .scorer-item:hover {
         background-color: rgba(0,0,0,0.02);
         }
         .scorer-item.red {
         background: #fff5f5;
         color: #d63031;
         border-left: 2px solid #d63031;
         }
         .scorer-item.blue {
         background: #f5f9ff;
         color: #0984e3;
         border-left: 2px solid #0984e3;
         }
         /* MODAL */
         #modalOverlay {
         display: none;
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background: rgba(0, 0, 0, 0.6);
         backdrop-filter: blur(8px);
         justify-content: center;
         align-items: center;
         z-index: 1000;
         animation: fadeInOverlay 0.3s ease;
         }
         @keyframes fadeInOverlay {
         from { opacity: 0; }
         to { opacity: 1; }
         }
         #modalBox {
         background: white;
         max-width: 600px;
         width: 90%;
         max-height: 80vh;
         overflow-y: auto;
         padding: 30px;
         border-radius: 16px;
         text-align: left;
         box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
         margin: 20px;
         animation: slideUp 0.3s ease;
         }
         @keyframes slideUp {
         from { transform: translateY(50px); opacity: 0; }
         to { transform: translateY(0); opacity: 1; }
         }
         #modalBox h2 {
         color: #333;
         margin-bottom: 20px;
         font-size: 24px;
         }
         #closeModal {
         float: right;
         cursor: pointer;
         font-size: 28px;
         background: #f0f0f0;
         border-radius: 8px;
         padding: 4px 12px;
         line-height: 1;
         transition: all 0.2s ease;
         border: none;
         outline: none;
         }
         #closeModal:hover {
         background: #667eea;
         color: white;
         transform: rotate(90deg);
         }
         #closeModal:focus {
         box-shadow: 0 0 0 3px rgba(75, 91, 231, 0.3);
         }
         .empty-state {
         text-align: center;
         padding: 60px 20px;
         color: white;
         font-size: 18px;
         opacity: 0.9;
         }
         /* MOBILE STYLES */
         @media (max-width: 768px) {
         body {
         padding: 15px;
         }
         header {
         padding: 15px 20px;
         margin-bottom: 20px;
         }
         .logo {
         font-size: 22px;
         }
         h1 {
         font-size: 26px;
         margin-bottom: 20px;
         }
         .link-back {
         font-size: 14px;
         padding: 10px 16px;
         }
         .back-button-top {
         margin-bottom: 20px;
         }
         .back-btn {
         width: 100%;
         padding: 14px;
         font-size: 15px;
         }
         .match-box {
         padding: 18px;
         margin-bottom: 26px;
         }
         .match-meta {
         font-size: 12px;
         flex-direction: column;
         align-items: flex-start;
         gap: 8px;
         }
         .match-links {
         gap: 8px;
         }
         .info-link {
         font-size: 12px;
         padding: 5px 10px;
         min-height: 36px;
         }
         .team-logo {
         width: 60px;
         height: 60px;
         }
         .match-teams .team-logo {
         width: 100px;
         height: 100px;
         }
         .team-name {
         font-size: 13px;
         margin-top: 6px;
         }
         .score {
         font-size: 32px;
         }
         .scorer-item {
         font-size: 14px;
         padding: 10px 14px;
         }
         #modalBox {
         width: 95%;
         padding: 25px;
         margin: 10px;
         }
         #modalBox h2 {
         font-size: 20px;
         }
         #closeModal {
         font-size: 24px;
         padding: 2px 10px;
         }
         .captain-badge {
         font-size: 9px;
         padding: 2px 5px;
         margin-left: 5px;
         }
         .goalkeeper-badge {
         font-size: 15px;
         margin-left: 5px;
         }
         }
         @media (max-width: 480px) {
         h1 {
         font-size: 22px;
         }
         .match-box {
         padding: 15px;
         }
         .team-logo {
         width: 50px;
         height: 50px;
         }
         .team-name {
         font-size: 12px;
         }
         .score {
         font-size: 28px;
         margin: 8px 0;
         }
         .match-meta {
         font-size: 11px;
         }
         .info-link {
         font-size: 11px;
         padding: 4px 8px;
         }
         .match-teams {
         gap: 8px;
         }
         #modalBox {
         padding: 20px;
         }
         .captain-badge {
         font-size: 8px;
         padding: 1px 4px;
         }
         .goalkeeper-badge {
         font-size: 13px;
         }
         }
      </style>
   </head>
   <body>
      <div class="container">
         <h1>Sve odigrane utakmice</h1>
         <div class="back-button-top">
            <a href="index.html" class="back-btn">‚Üê Nazad na rezultate</a>
         </div>
         <div id="historyList"></div>
      </div>
      <!-- MODAL -->
      <div id="modalOverlay">
         <div id="modalBox">
            <span id="closeModal">‚úï</span>
            <h2 id="modalTitle">Info o meƒçu</h2>
            <div id="modalContent" style="margin-top:10px;"></div>
         </div>
      </div>
      <script type="module">
         import { onValue } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";
         
         let allMatches = [];
         let allPlayers = { crveni: {}, plavi: {} };
         
         /* -------- FORMAT PLAYER NAME -------- */
         function formatPlayerName(name) {
           if (!name) return '';
         
           let displayName = name;
           let badges = '';
         
           const captainRegex = /\s*\(c\)\s*/i;
           if (captainRegex.test(name)) {
             displayName = name.replace(captainRegex, ' ').trim();
             badges += '<span class="captain-badge">C</span>';
           }
         
           const goalkeeperRegex = /\s*\(g\)\s*/i;
           if (goalkeeperRegex.test(name)) {
             displayName = name.replace(goalkeeperRegex, ' ').trim();
             badges += '<span class="goalkeeper-badge">üß§</span>';
           }
         
           return displayName + badges;
         }
         
         /* LOAD ALL MATCHES */
         onValue(window.dbRef("matches"), snap => {
           const data = snap.val() || {};
           allMatches = Object.values(data).sort((a,b)=>b.timestamp - a.timestamp);
           renderHistory(allMatches);
         });
         
         /* LOAD PLAYERS */
         onValue(window.dbRef("players"), snap => {
           const players = snap.val() || {};
           allPlayers = players || { crveni: {}, plavi: {} };
         });
         
         /* RENDER HISTORY */
         function renderHistory(matches) {
           const box = document.getElementById("historyList");
           box.innerHTML = "";
         
           if (!matches.length) {
             box.innerHTML = "<div class='empty-state'>üìã Jo≈° uvek nema odigranih utakmica</div>";
             return;
           }
         
           matches.forEach((m, idx) => {
             const matchLinks = `
         ${m.info ? `<div class="info-link" onclick="openMatchInfo(${idx})">‚ÑπÔ∏è Info o meƒçu</div>` : ""}
         <div class="info-link" onclick="openMatchScorers(${idx})">‚öΩ Strelci</div>
         <div class="info-link" onclick="openMatchLineup(${idx})">üßç Sastavi</div>
         `;
         
         
             box.innerHTML += `
               <div class="match-box">
                 <div class="match-meta">
                   <div>Kolo ${m.round} ‚Äî ${m.date} u ${m.time}</div>
                   <div class="match-links">${matchLinks}</div>
                 </div>
         
                 <div class="match-teams">
                   <!-- CRVENI -->
                   <div style="text-align:center;">
                     <img src="crveni.png" class="team-logo" alt="Crveni">
                     <div class="team-name" style="color:#c00000;">Crveni</div>
                   </div>
         
                   <div class="score">${m.red} - ${m.blue}</div>
         
                   <!-- PLAVI -->
                   <div style="text-align:center;">
                     <img src="plavi.png" class="team-logo" alt="Plavi">
                     <div class="team-name" style="color:#0044cc;">Plavi</div>
                   </div>
                 </div>
               </div>
             `;
           });
         }
         
         /* -------- MODAL - INFO -------- */
         window.openMatchInfo = idx => {
           const match = allMatches[idx];
           if (!match) return;
         
           document.getElementById("modalTitle").innerText = "Info o meƒçu";
           document.getElementById("modalContent").innerHTML = `<div style="white-space:pre-line; line-height: 1.6;">${match.info || ''}</div>`;
           document.getElementById("modalOverlay").style.display = "flex";
         };
         
         /* -------- MODAL - SCORERS -------- */
         window.openMatchScorers = idx => {
         const match = allMatches[idx];
         if (!match) return;
         
         document.getElementById("modalTitle").innerText = "‚öΩ Strelci na meƒçu";
         
         const scorers = match.scorers || [];
         
         if (!scorers.length) {
         document.getElementById("modalContent").innerHTML =
         '<p style="text-align:center; color:#999;">Nema strelaca</p>';
         } else {
         const grouped = {};
         
         scorers.forEach(s => {
         const key = s.type === "own_goal"
         ? "__og__"
         : `${s.team}:${s.id}`;
         grouped[key] = (grouped[key] || 0) + 1;
         });
         
         document.getElementById("modalContent").innerHTML =
         Object.entries(grouped)
         .map(([key, count]) => {
         if (key === "__og__") {
         return {
         isOG: true,
         name: "Autogol",
         teamClass: "red",
         count
         };
         }
         
         const [team, id] = key.split(":");
         const rawName = allPlayers[team]?.[id]?.name || "(nepoznat)";
         
         return {
         isOG: false,
         name: rawName.replace(/\s*\(c\)|\s*\(g\)/gi, "").trim(),
         displayName: rawName,
         teamClass: team === "crveni" ? "red" : "blue",
         count
         };
         })
         .sort((a, b) => {
         // autogol uvek na dnu
         if (a.isOG && !b.isOG) return 1;
         if (!a.isOG && b.isOG) return -1;
         
         // vi≈°e golova prvo
         if (b.count !== a.count) {
         return b.count - a.count;
         }
         
         // ime A‚ÄìZ
         return a.name.localeCompare(b.name, "sr");
         })
         .map(item => `
         <div class="scorer-item ${item.teamClass}">
         ${item.isOG ? item.name : formatPlayerName(item.displayName)}
         <strong>‚öΩ √ó${item.count}</strong>
         </div>
         `)
         .join("");
         }
         
         document.getElementById("modalOverlay").style.display = "flex";
         };
         
         window.openMatchLineup = idx => {
         const match = allMatches[idx];
         if (!match) return;
         
         document.getElementById("modalTitle").innerText = "üßç Sastavi";
         
         renderMatchLineup(match);
         document.getElementById("modalOverlay").style.display = "flex";
         };
         
         function renderMatchLineup(match) {
         const red = [];
         const blue = [];
         
         Object.entries(match.played || {}).forEach(([id, team]) => {
         const name =
         team === "crveni"
         ? allPlayers.crveni?.[id]?.name
         : allPlayers.plavi?.[id]?.name;
         
         if (!name) return;
         (team === "crveni" ? red : blue).push(name);
         });
         
         document.getElementById("modalContent").innerHTML = `
         <h3 style="color:#c00000;margin-bottom:10px;">üî¥ Crveni</h3>
         ${red.length
         ? red.map(p => `<div class="scorer-item red">${formatPlayerName(p)}</div>`).join("")
         : `<p style="color:#999;">Nema podataka</p>`}
         
         <h3 style="color:#0044cc;margin:16px 0 10px;">üîµ Plavi</h3>
         ${blue.length
         ? blue.map(p => `<div class="scorer-item blue">${formatPlayerName(p)}</div>`).join("")
         : `<p style="color:#999;">Nema podataka</p>`}
         `;
         }
         
         document.getElementById("closeModal").onclick = () =>
           document.getElementById("modalOverlay").style.display = "none";
         
         document.getElementById("modalOverlay").onclick = e => {
           if (e.target.id === "modalOverlay")
             document.getElementById("modalOverlay").style.display = "none";
         };
      </script>
   </body>
</html>
