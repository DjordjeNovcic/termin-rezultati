  <!DOCTYPE html>
    <html lang="sr">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Istorija utakmica</title>
      <script type="module" src="firebase.mjs"></script>

      <style>
        * {
          box-sizing: border-box;
        }

        body {
          font-family: Arial, sans-serif;
          max-width: 900px;
          margin: 20px auto;
          padding: 0 15px;
          text-align: center;
        }

        h1 {
          margin-bottom: 25px;
          font-size: 28px;
        }

        .link-back {
          display: inline-block;
          margin-bottom: 20px;
          font-size: 15px;
          color: #0044cc;
          cursor: pointer;
          text-decoration: none;
          padding: 10px 20px;
          background: #f0f0f0;
          border-radius: 6px;
        }

        .link-back:hover {
          background: #e0e0e0;
        }

        .match-box {
          padding: 20px;
          border-radius: 12px;
          background: #f9f9f9;
          border: 1px solid #ddd;
          margin-bottom: 18px;
        }

        .team-logo {
          width: 70px;
          height: 70px;
          object-fit: contain;
        }

        .team-name {
          font-weight: bold;
          font-size: 14px;
          margin-top: 4px;
        }

        .score {
          font-size: 32px;
          font-weight: bold;
          margin: 10px 0;
        }

        .info-link {
          color: #0044cc;
          cursor: pointer;
          font-size: 14px;
          text-decoration: underline;
          margin-top: 4px;
          display: inline-block;
          margin-right: 12px;
        }

        .match-meta {
          opacity: 0.7;
          margin-bottom: 8px;
          font-size: 14px;
        }

        .match-teams {
          display: flex;
          justify-content: space-around;
          align-items: center;
        }

        /* Captain and Goalkeeper badges */
        .captain-badge {
          display: inline-block;
          background: linear-gradient(135deg, #ffd700, #ffed4e);
          color: #333;
          font-weight: bold;
          padding: 2px 6px;
          border-radius: 4px;
          margin-left: 6px;
          font-size: 11px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.2);
          border: 1px solid #daa520;
        }

        .goalkeeper-badge {
          margin-left: 6px;
          font-size: 18px;
        }

        .scorer-item {
          padding: 8px 12px;
          margin: 6px 0;
          border-radius: 6px;
          font-size: 15px;
        }

        .scorer-item.red {
          background: #ffe5e5;
          color: #b10000;
        }

        .scorer-item.blue {
          background: #e5f0ff;
          color: #0044cc;
        }

        /* MODAL */
        #modalOverlay {
          display: none;
          position: fixed;
          top: 0; left: 0;
          width: 100%; height: 100%;
          background: rgba(0,0,0,0.55);
          backdrop-filter: blur(2px);
          justify-content: center;
          align-items: center;
          z-index: 1000;
        }

        #modalBox {
          background: white;
          max-width: 600px;
          width: 90%;
          max-height: 80vh;
          overflow-y: auto;
          padding: 25px;
          border-radius: 12px;
          text-align: left;
          box-shadow: 0 0 20px rgba(0,0,0,0.25);
          margin: 20px;
        }

        #closeModal {
          float: right;
          cursor: pointer;
          font-size: 24px;
          background: #ccc;
          border-radius: 4px;
          padding: 4px 10px;
          line-height: 1;
        }

        /* MOBILE STYLES */
        @media (max-width: 768px) {
          body {
            margin: 10px auto;
            padding: 0 10px;
          }

          h1 {
            font-size: 22px;
            margin-bottom: 15px;
          }

          .link-back {
            width: 100%;
            padding: 12px;
            font-size: 14px;
            margin-bottom: 15px;
          }

          .match-box {
            padding: 15px;
            margin-bottom: 15px;
          }

          .team-logo {
            width: 55px;
            height: 55px;
          }

          .team-name {
            font-size: 12px;
            margin-top: 3px;
          }

          .score {
            font-size: 26px;
          }

          .match-meta {
            font-size: 12px;
          }

          .info-link {
            font-size: 12px;
            margin-right: 8px;
          }

          .scorer-item {
            font-size: 14px;
            padding: 6px 10px;
          }

          #modalBox {
            width: 95%;
            padding: 20px;
            margin: 10px;
          }

          #closeModal {
            font-size: 20px;
            padding: 2px 8px;
          }

          .captain-badge {
            font-size: 9px;
            padding: 1px 4px;
          }

          .goalkeeper-badge {
            font-size: 14px;
          }
        }

        @media (max-width: 480px) {
          h1 {
            font-size: 20px;
          }

          .match-box {
            padding: 12px;
          }

          .team-logo {
            width: 45px;
            height: 45px;
          }

          .team-name {
            font-size: 11px;
          }

          .score {
            font-size: 22px;
            margin: 8px 0;
          }

          .match-meta {
            font-size: 11px;
            margin-bottom: 6px;
          }

          .match-teams {
            gap: 10px;
          }

          .info-link {
            font-size: 11px;
            margin-right: 6px;
          }
        }
      </style>
    </head>
    <body>

    <a class="link-back" href="index.html">‚Üê Nazad na rezultate</a>

    <h1>Istorija svih utakmica</h1>

    <div id="historyList"></div>

    <!-- MODAL -->
    <div id="modalOverlay">
      <div id="modalBox">
        <span id="closeModal">‚úï</span>
        <h2 id="modalTitle">Info o meƒçu</h2>
        <div id="modalContent" style="margin-top:10px;"></div>
      </div>
    </div>

    <script type="module">
    import { onValue } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

    let allMatches = [];
    let allPlayers = { crveni: {}, plavi: {} };

    /* -------- FORMAT PLAYER NAME -------- */
    function formatPlayerName(name) {
      if (!name) return '';

      let displayName = name;
      let badges = '';

      const captainRegex = /\s*\(c\)\s*/i;
      if (captainRegex.test(name)) {
        displayName = name.replace(captainRegex, ' ').trim();
        badges += '<span class="captain-badge">C</span>';
      }

      const goalkeeperRegex = /\s*\(g\)\s*/i;
      if (goalkeeperRegex.test(name)) {
        displayName = name.replace(goalkeeperRegex, ' ').trim();
        badges += '<span class="goalkeeper-badge">üß§</span>';
      }

      return displayName + badges;
    }

    /* LOAD ALL MATCHES */
    onValue(window.dbRef("matches"), snap => {
      const data = snap.val() || {};
      allMatches = Object.values(data).sort((a,b)=>b.timestamp - a.timestamp);
      renderHistory(allMatches);
    });

    /* LOAD PLAYERS */
    onValue(window.dbRef("players"), snap => {
      const players = snap.val() || {};
      allPlayers = players || { crveni: {}, plavi: {} };
    });

    /* RENDER HISTORY */
    function renderHistory(matches) {
      const box = document.getElementById("historyList");
      box.innerHTML = "";

      if (!matches.length) {
        box.innerHTML = "<p style='margin-top:30px; opacity:0.7;'>Nema odigranih utakmica.</p>";
        return;
      }

      matches.forEach((m, idx) => {
        const matchLinks = `
          ${m.info ? `<div class="info-link" onclick="openMatchInfo(${idx})">‚Ñπ Info o meƒçu</div>` : ""}
          <div class="info-link" onclick="openMatchScorers(${idx})">‚öΩ Vidi listu strelaca</div>
        `;

        box.innerHTML += `
          <div class="match-box">

            <div class="match-meta">
              Kolo ${m.round} ‚Äî ${m.date} u ${m.time}
              <div>${matchLinks}</div>
            </div>

            <div class="match-teams">

              <!-- CRVENI -->
              <div style="text-align:center;">
                <img src="crveni.png" class="team-logo" alt="Crveni">
                <div class="team-name" style="color:#c00000;">Crveni</div>
              </div>

              <div class="score">${m.red} - ${m.blue}</div>

              <!-- PLAVI -->
              <div style="text-align:center;">
                <img src="plavi.png" class="team-logo" alt="Plavi">
                <div class="team-name" style="color:#0044cc;">Plavi</div>
              </div>

            </div>
          </div>
        `;
      });
    }

    /* -------- MODAL - INFO -------- */
    window.openMatchInfo = idx => {
      const match = allMatches[idx];
      if (!match) return;

      document.getElementById("modalTitle").innerText = "Info o meƒçu";
      document.getElementById("modalContent").innerHTML = `<div style="white-space:pre-line;">${match.info || ''}</div>`;
      document.getElementById("modalOverlay").style.display = "flex";
    };

    /* -------- MODAL - SCORERS -------- */
    window.openMatchScorers = idx => {
      const match = allMatches[idx];
      if (!match) return;

      const scorers = match.scorers || [];

      document.getElementById("modalTitle").innerText = "Strelci meƒça";

      if (scorers.length === 0) {
        document.getElementById("modalContent").innerHTML = '<p>Nema strelaca za ovaj meƒç.</p>';
      } else {
        let html = '';
        scorers.forEach(scorer => {
          const playerName = allPlayers[scorer.team]?.[scorer.id]?.name || '(nepoznat)';
          const teamClass = scorer.team === 'crveni' ? 'red' : 'blue';
          html += `<div class="scorer-item ${teamClass}">${formatPlayerName(playerName)}</div>`;
        });
        document.getElementById("modalContent").innerHTML = html;
      }

      document.getElementById("modalOverlay").style.display = "flex";
    };

    document.getElementById("closeModal").onclick = () =>
      document.getElementById("modalOverlay").style.display = "none";

    document.getElementById("modalOverlay").onclick = e => {
      if (e.target.id === "modalOverlay")
        document.getElementById("modalOverlay").style.display = "none";
    };
    </script>

    </body>
    </html>
