 <!DOCTYPE html>
  <html lang="sr">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Upravljanje igraƒçima</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="firebase.mjs"></script>

    <style>
      /* Page-specific overrides only */
      .container {
        max-width: 900px;
      }

      #resetStatsBtn {
        background: linear-gradient(135deg, #ff4757 0%, #ee5a6f 100%);
        color: white;
        padding: 14px 24px;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        font-size: 16px;
        margin-bottom: 25px;
        width: 100%;
        max-width: 400px;
        display: block;
        margin-left: auto;
        margin-right: auto;
        font-weight: 700;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      #resetStatsBtn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255, 71, 87, 0.4);
      }

      /* Modal */
      #modalOverlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.7);
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(4px);
        z-index: 999;
        padding: 20px;
      }

      #modalBox {
        background: white;
        padding: 30px;
        border-radius: 16px;
        width: 90%;
        max-width: 420px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: slideUp 0.3s ease;
        max-height: 90vh;
        overflow-y: auto;
      }

      @keyframes slideUp {
        from {
          transform: translateY(50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      #modalBox h3 {
        margin-top: 0;
        margin-bottom: 20px;
        color: #2d3436;
      }

      .modal-buttons {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        justify-content: flex-end;
      }

      .modal-buttons button {
        padding: 12px 24px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 16px;
        min-height: 48px;
        flex: 1;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      #renameCancel {
        background: #636e72;
        color: white;
      }

      #renameCancel:hover {
        background: #4a5558;
        transform: translateY(-2px);
      }

      #renameConfirm {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      #renameConfirm:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
      }

      @media (max-width: 768px) {
        #modalBox {
          padding: 20px;
          width: 95%;
        }

        .modal-buttons {
          flex-direction: column;
        }
      }
    </style>
  </head>

  <body>

  <div class="container">
    <!-- HEADER -->
    <header>
      <div class="logo">‚öΩ Admin Panel</div>
      <div class="nav-buttons">
        <button class="nav-btn" onclick="window.location.href='admin.html'">Meƒçevi</button>
        <button class="nav-btn active" onclick="window.location.href='admin-igraci.html'">Igraƒçi</button>
        <button class="nav-btn logout" onclick="logout()">Logout</button>
      </div>
    </header>

    <script>
      if (localStorage.getItem("admin") !== "1") window.location.href="login.html";
      function logout(){ localStorage.removeItem("admin"); window.location.href="index.html"; }
    </script>

    <!-- MAIN CARD -->
    <div class="card">
      <h1 class="card-title">Upravljanje igraƒçima</h1>

      <!-- RESET SVIH STATISTIKA -->
      <button id="resetStatsBtn">
        Resetuj SVE golove i utakmice
      </button>

      <!-- CRVENI -->
      <div class="team-title" style="color:#d63031;">Crveni</div>
      <div class="input-row">
        <input id="redInput" placeholder="Ime igraƒça">
        <button class="add-btn" onclick="addPlayer('crveni')">Dodaj</button>
      </div>
      <div class="table-wrapper">
        <table>
          <thead>
          <tr>
            <th data-sort="name" data-team="crveni">Igraƒç</th>
            <th data-sort="goals" data-team="crveni">Golovi</th>
            <th data-sort="matches" data-team="crveni">Utakmice</th>
            <th>Akcija</th>
          </tr>
          </thead>
          <tbody id="redList"></tbody>
        </table>
      </div>

      <!-- PLAVI -->
      <div class="team-title" style="color:#0984e3;">Plavi</div>
      <div class="input-row">
        <input id="blueInput" placeholder="Ime igraƒça">
        <button class="add-btn" onclick="addPlayer('plavi')">Dodaj</button>
      </div>
      <div class="table-wrapper">
        <table>
          <thead>
          <tr>
            <th data-sort="name" data-team="plavi">Igraƒç</th>
            <th data-sort="goals" data-team="plavi">Golovi</th>
            <th data-sort="matches" data-team="plavi">Utakmice</th>
            <th>Akcija</th>
          </tr>
          </thead>
          <tbody id="blueList"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- MODAL RENAME -->
  <div id="modalOverlay">
    <div id="modalBox">
      <h3>Izmena imena igraƒça</h3>

      <input id="renameInput" placeholder="Novo ime...">

      <div class="modal-buttons">
        <button id="renameCancel">Otka≈æi</button>
        <button id="renameConfirm">Saƒçuvaj</button>
      </div>
    </div>
  </div>

  <script type="module">
  import { onValue, push, set, update, remove, get }
    from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

  /* ------------------ STATE ------------------ */
  const playersData = {
    crveni: {},
    plavi: {}
  };

  const sortState = {
    crveni: { field: 'name', dir: 'asc' },
    plavi: { field: 'name', dir: 'asc' }
  };

  /* ------------------ FORMAT PLAYER NAME ------------------ */
  function formatPlayerName(name) {
    if (!name) return '';

    let displayName = name;
    let badges = '';

    // Check for captain
    const captainRegex = /\s*\(c\)\s*/i;
    if (captainRegex.test(name)) {
      displayName = name.replace(captainRegex, ' ').trim();
      badges += '<span class="captain-badge">C</span>';
    }

    // Check for goalkeeper
    const goalkeeperRegex = /\s*\(g\)\s*/i;
    if (goalkeeperRegex.test(name)) {
      displayName = name.replace(goalkeeperRegex, ' ').trim();
      badges += '<span class="goalkeeper-badge">üß§</span>';
    }

    return displayName + badges;
  }

  /* ------------------ TEMPLATE ------------------ */
  function rowTemplate(id, player, team) {
    return `
      <tr>
        <td>${formatPlayerName(player.name)}</td>
        <td>${player.goals || 0}</td>
        <td>${player.matches || 0}</td>
        <td>
          <button class="edit-btn" onclick="openRename('${team}','${id}','${player.name}')">Izmeni</button>
          <button class="del-btn" onclick="deletePlayer('${team}','${id}','${player.name}')">Obri≈°i</button>
        </td>
      </tr>
    `;
  }

  /* ------------------ RENDER WITH SORTING ------------------ */
  function renderPlayers(team, elementId) {
    const tbody = document.getElementById(elementId);
    const data = playersData[team];

    // Convert to array
    let players = Object.entries(data).map(([id, p]) => ({
      id,
      name: p.name || "",
      goals: Number(p.goals) || 0,
      matches: Number(p.matches) || 0
    }));

    // Sort
    const { field, dir } = sortState[team];
    players.sort((a, b) => {
      if (field === 'name') {
        // Remove badges for sorting
        const nameA = a.name.replace(/\s*\(c\)\s*/gi, '').replace(/\s*\(g\)\s*/gi, '').trim().toLowerCase();
        const nameB = b.name.replace(/\s*\(c\)\s*/gi, '').replace(/\s*\(g\)\s*/gi, '').trim().toLowerCase();
        return dir === 'asc'
          ? nameA.localeCompare(nameB, 'sr')
          : nameB.localeCompare(nameA, 'sr');
      } else {
        if (a[field] === b[field]) {
          const nameA = a.name.replace(/\s*\(c\)\s*/gi, '').replace(/\s*\(g\)\s*/gi, '').trim();
          const nameB = b.name.replace(/\s*\(c\)\s*/gi, '').replace(/\s*\(g\)\s*/gi, '').trim();
          return nameA.localeCompare(nameB, 'sr');
        }
        return dir === 'asc' ? a[field] - b[field] : b[field] - a[field];
      }
    });

    // Render
    tbody.innerHTML = "";
    players.forEach(p => {
      tbody.innerHTML += rowTemplate(p.id, p, team);
    });

    // Update sort indicators
    updateSortIndicators(team);
  }

  /* ------------------ UPDATE SORT INDICATORS ------------------ */
  function updateSortIndicators(team) {
    const { field, dir } = sortState[team];

    document.querySelectorAll(`th[data-team="${team}"]`).forEach(th => {
      th.classList.remove('sorted-asc', 'sorted-desc');
      if (th.dataset.sort === field) {
        th.classList.add(dir === 'asc' ? 'sorted-asc' : 'sorted-desc');
      }
    });
  }

  /* ------------------ LOAD ------------------ */
  function loadPlayers(team, elementId) {
    onValue(window.dbRef("players/" + team), snap => {
      playersData[team] = snap.val() || {};
      renderPlayers(team, elementId);
    });
  }

  loadPlayers("crveni","redList");
  loadPlayers("plavi","blueList");

  /* ------------------ SORTING EVENT LISTENERS ------------------ */
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('th[data-sort]').forEach(th => {
      th.addEventListener('click', () => {
        const field = th.dataset.sort;
        const team = th.dataset.team;

        // Toggle direction if same field, otherwise reset to desc
        if (sortState[team].field === field) {
          sortState[team].dir = sortState[team].dir === 'asc' ? 'desc' : 'asc';
        } else {
          sortState[team].field = field;
          sortState[team].dir = field === 'name' ? 'asc' : 'desc';
        }

        renderPlayers(team, team === 'crveni' ? 'redList' : 'blueList');
      });
    });
  });

  /* ------------------ ADD ------------------ */
  window.addPlayer = team => {
    const input = document.getElementById(team === "crveni" ? "redInput" : "blueInput");
    const name = input.value.trim();
    if (!name) return;

    push(window.dbRef("players/" + team), {
      name, goals: 0, matches: 0
    });

    input.value = "";
  };

  /* ------------------ DELETE ‚Äî HARD DELETE ------------------ */
  window.deletePlayer = async (team, id, name) => {
    const cleanName = name.replace(/\s*\(c\)\s*/gi, '').replace(/\s*\(g\)\s*/gi, '').trim();
    if (!confirm(`Obrisati igraƒça ${cleanName} i ukloniti ga iz SVIH meƒçeva?`)) return;

    const matchesSnap = await get(window.dbRef("matches"));
    const matches = matchesSnap.val() || {};

    for (const matchId of Object.keys(matches)) {
      const m = matches[matchId];

      // ukloni iz played (po ID-u)
      if (m.played && m.played[id]) {
        delete m.played[id];
      }

      // ukloni iz scorers (po ID-u)
      if (m.scorers) {
        m.scorers = m.scorers.filter(s => s.id !== id);
      }

      await update(window.dbRef("matches/" + matchId), {
        played: m.played || {},
        scorers: m.scorers || []
      });
    }

    await remove(window.dbRef(`players/${team}/${id}`));
  };

  /* ------------------ RENAME ------------------ */
  let renameTeam = null;
  let renameId   = null;

  window.openRename = (team, id, oldName) => {
    renameTeam = team;
    renameId = id;
    document.getElementById("renameInput").value = oldName;
    document.getElementById("modalOverlay").style.display = "flex";
  };

  document.getElementById("renameConfirm").onclick = async () => {
    const newName = document.getElementById("renameInput").value.trim();
    if (!newName) return;

    await update(window.dbRef(`players/${renameTeam}/${renameId}`), { name: newName });
    document.getElementById("modalOverlay").style.display = "none";
  };

  document.getElementById("renameCancel").onclick = () => {
    document.getElementById("modalOverlay").style.display = "none";
  };

  /* ------------------ RESET STATISTICS ------------------ */
  document.getElementById("resetStatsBtn").onclick = async () => {
    if (!confirm("Da li sigurno ≈æeli≈° da resetuje≈° SVE golove i utakmice?")) return;

    const snap = await get(window.dbRef("players"));
    const data = snap.val() || {};

    for (const team of ["crveni","plavi"]) {
      if (!data[team]) continue;
      for (const id of Object.keys(data[team])) {
        await update(window.dbRef(`players/${team}/${id}`), {
          goals: 0,
          matches: 0
        });
      }
    }

    alert("Statistika resetovana!");
  };
  </script>

  <script>
  // klik na pozadinu = zatvori modal
  document.getElementById("modalOverlay").onclick = e => {
    if (e.target.id === "modalOverlay")
      e.target.style.display = "none";
  };
  </script>

  </body>
  </html>

  Now both pages will have the exact same style and everything will be centered properly on desktop!

> should I change something now when i have style.css in admin.html? 

‚è∫ Yes! You should update admin.html to use the styles.css file instead of the inline styles.

  Remove the entire <style> block from admin.html and add the link to styles.css:

  <!DOCTYPE html>
  <html lang="sr">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin ‚Äì Meƒçevi</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="firebase.mjs"></script>
  </head>

  <body>

  <div class="container">
    <!-- HEADER -->
    <header>
      <div class="logo">‚öΩ Admin Panel</div>
      <div class="nav-buttons">
        <button class="nav-btn active" onclick="window.location.href='admin.html'">Meƒçevi</button>
        <button class="nav-btn" onclick="window.location.href='admin-igraci.html'">Igraƒçi</button>
        <button class="nav-btn logout" onclick="logout()">Logout</button>
      </div>
    </header>

    <script>
      if (localStorage.getItem("admin") !== "1") window.location.href="login.html";
      function logout(){ localStorage.removeItem("admin"); window.location.href="index.html"; }
    </script>

    <!-- MAIN FORM CARD -->
    <div class="card">
      <h1 class="card-title">Upravljanje meƒçevima</h1>

      <div class="form-group">
        <label class="form-label">Kolo</label>
        <input id="round" type="number" placeholder="Unesite broj kola">
      </div>

      <div class="input-row">
        <div class="form-group">
          <label class="form-label">Datum</label>
          <input id="date" type="date">
        </div>
        <div class="form-group">
          <label class="form-label">Vreme</label>
          <input id="time" type="time">
        </div>
      </div>

      <div class="input-row">
        <div class="form-group">
          <label class="form-label">Golovi Crveni</label>
          <input id="red" type="number" placeholder="0">
        </div>
        <div class="form-group">
          <label class="form-label">Golovi Plavi</label>
          <input id="blue" type="number" placeholder="0">
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Info o meƒçu</label>
        <textarea id="info" placeholder="Dodajte dodatne informacije o meƒçu..."></textarea>
      </div>

      <!-- IGRALI CRVENI -->
      <div class="section-header">
        <div class="section-icon red">üë•</div>
        <div class="section-title">Igrali ‚Äì Crveni</div>
      </div>
      <div class="players-grid" id="playedRed"></div>

      <!-- STRELCI CRVENI -->
      <div class="section-header">
        <div class="section-icon red">‚öΩ</div>
        <div class="section-title">Strelci ‚Äì Crveni</div>
      </div>
      <div class="players-grid" id="scorersRedPlayers"></div>
      <div class="scorers-tags" id="scorersRedTags"></div>

      <!-- IGRALI PLAVI -->
      <div class="section-header">
        <div class="section-icon blue">üë•</div>
        <div class="section-title">Igrali ‚Äì Plavi</div>
      </div>
      <div class="players-grid" id="playedBlue"></div>

      <!-- STRELCI PLAVI -->
      <div class="section-header">
        <div class="section-icon blue">‚öΩ</div>
        <div class="section-title">Strelci ‚Äì Plavi</div>
      </div>
      <div class="players-grid" id="scorersBluePlayers"></div>
      <div class="scorers-tags" id="scorersBlueTags"></div>

      <!-- ACTION BUTTONS -->
      <button class="btn btn-primary" id="saveBtn">Saƒçuvaj meƒç</button>
      <button class="btn btn-warning" id="updateBtn">Saƒçuvaj izmene</button>
      <button class="btn btn-secondary" id="cancelBtn" onclick="clearForm()">Otka≈æi izmenu</button>
    </div>

    <!-- MATCHES LIST CARD -->
    <div class="card">
      <h2 class="card-title">Lista meƒçeva</h2>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Kolo</th>
              <th>Rezultat</th>
              <th>Datum</th>
              <th>Akcije</th>
            </tr>
          </thead>
          <tbody id="matchList"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- SCRIPT -->
  <script type="module">
  import { onValue, push, update, remove, get }
    from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

  let players = { crveni:{}, plavi:{} };
  let scorers = [];
  let editingId = null;
  let pendingPlayed = null;

  /* FORMAT PLAYER NAME */
  function formatPlayerName(name) {
    if (!name) return '';
    let displayName = name;
    let badges = '';

    const captainRegex = /\s*\(c\)\s*/i;
    if (captainRegex.test(name)) {
      displayName = name.replace(captainRegex, ' ').trim();
      badges += '<span class="captain-badge">C</span>';
    }

    const goalkeeperRegex = /\s*\(g\)\s*/i;
    if (goalkeeperRegex.test(name)) {
      displayName = name.replace(goalkeeperRegex, ' ').trim();
      badges += '<span class="goalkeeper-badge">üß§</span>';
    }

    return displayName + badges;
  }

  /* LOAD PLAYERS */
  onValue(window.dbRef("players"), snap => {
    players = snap.val() || { crveni:{}, plavi:{} };
    renderPlayers();
    if (pendingPlayed) applyPlayedSelection(pendingPlayed);
  });

  /* RENDER PLAYERS */
  function renderPlayers() {
    const PR = document.getElementById("playedRed");
    const PB = document.getElementById("playedBlue");
    const SRP = document.getElementById("scorersRedPlayers");
    const SBP = document.getElementById("scorersBluePlayers");

    PR.innerHTML = PB.innerHTML = SRP.innerHTML = SBP.innerHTML = "";

    Object.entries(players.crveni).forEach(([id, p]) => {
      PR.innerHTML  += `<div class="player-btn" data-id="${id}" data-team="crveni">${formatPlayerName(p.name)}</div>`;
      SRP.innerHTML += `<div class="player-btn" data-id="${id}" data-team="crveni">${formatPlayerName(p.name)}</div>`;
    });

    Object.entries(players.plavi).forEach(([id, p]) => {
      PB.innerHTML  += `<div class="player-btn" data-id="${id}" data-team="plavi">${formatPlayerName(p.name)}</div>`;
      SBP.innerHTML += `<div class="player-btn" data-id="${id}" data-team="plavi">${formatPlayerName(p.name)}</div>`;
    });

    if (pendingPlayed) applyPlayedSelection(pendingPlayed);
  }

  /* APPLY PLAYED SELECTION */
  function applyPlayedSelection(played) {
    document.querySelectorAll("#playedRed .player-btn, #playedBlue .player-btn")
      .forEach(b => b.classList.remove("active"));

    Object.entries(played || {}).forEach(([playerId, team]) => {
      const container = team === "crveni" ? "#playedRed" : "#playedBlue";
      const btn = document.querySelector(`${container} .player-btn[data-id="${playerId}"]`);
      if (btn) btn.classList.add("active");
    });
  }

  /* EVENT DELEGATION */
  (function setupEventDelegation() {
    document.getElementById("playedRed").addEventListener("click", (e) => {
      if (e.target.classList.contains("player-btn")) {
        e.target.classList.toggle("active");
        pendingPlayed = getPlayed();
      }
    });

    document.getElementById("playedBlue").addEventListener("click", (e) => {
      if (e.target.classList.contains("player-btn")) {
        e.target.classList.toggle("active");
        pendingPlayed = getPlayed();
      }
    });

    document.getElementById("scorersRedPlayers").addEventListener("click", (e) => {
      if (e.target.classList.contains("player-btn")) {
        scorers.push({ id: e.target.dataset.id, team: e.target.dataset.team });
        refreshTags();
      }
    });

    document.getElementById("scorersBluePlayers").addEventListener("click", (e) => {
      if (e.target.classList.contains("player-btn")) {
        scorers.push({ id: e.target.dataset.id, team: e.target.dataset.team });
        refreshTags();
      }
    });
  })();

  /* REFRESH TAGS */
  function refreshTags(){
    document.getElementById("scorersRedTags").innerHTML = "";
    document.getElementById("scorersBlueTags").innerHTML = "";

    scorers.forEach((s,i)=>{
      const rawName = players[s.team][s.id]?.name || "(obrisan)";
      const name = rawName.replace(/\s*\(c\)\s*/gi, '').replace(/\s*\(g\)\s*/gi, '').trim();
      const tag = `<div class="tag">${name}<button onclick="removeGoal(${i})">√ó</button></div>`;
      if (s.team==="crveni")
        document.getElementById("scorersRedTags").innerHTML += tag;
      else
        document.getElementById("scorersBlueTags").innerHTML += tag;
    });

    autoSetGoals();
  }

  window.removeGoal = i => { scorers.splice(i,1); refreshTags(); };

  function autoSetGoals() {
    red.value = scorers.filter(s => s.team === "crveni").length;
    blue.value = scorers.filter(s => s.team === "plavi").length;
  }

  /* GET PLAYED */
  function getPlayed() {
    const played = {};
    document.querySelectorAll("#playedRed .active,#playedBlue .active")
      .forEach(btn => played[btn.dataset.id] = btn.dataset.team);
    return played;
  }

  /* VALIDATE */
  function validate(){
    const e=[];
    if(!round.value) e.push("Kolo?");
    if(!date.value)  e.push("Datum?");
    if(!time.value)  e.push("Vreme?");
    if(!info.value.trim()) e.push("Info?");
    if(Object.keys(getPlayed()).length===0) e.push("Igrali?");
    if(scorers.length===0)  e.push("Strelci?");

    if(e.length){
      alert("Gre≈°ke:\n\n"+e.join("\n"));
      return false;
    }
    return true;
  }

  /* UPDATE STATS */
  async function updateOne(team,id,field,delta){
    const ref = window.dbRef(`players/${team}/${id}`);
    const snap = await get(ref);
    if (!snap.exists()) return;

    const p = snap.val();
    const next = Math.max(0, (p[field]||0) + delta);
    await update(ref, { [field]: next });
  }

  async function applyStats(match, dir) {
    const played = Object.entries(match.played || {});
    const scor = match.scorers || [];

    for (const [id, team] of played) {
      await updateOne(team, id, "matches", dir);
    }

    for (const s of scor) {
      await updateOne(s.team, s.id, "goals", dir);
    }
  }

  /* SAVE MATCH */
  saveBtn.onclick = async () =>{
    if(!validate()) return;

    const match = {
      round:round.value,
      date:date.value,
      time:time.value,
      red:+red.value,
      blue:+blue.value,
      info:info.value.trim(),
      played:getPlayed(),
      scorers: JSON.parse(JSON.stringify(scorers)),
      timestamp:Date.now()
    };

    await push(window.dbRef("matches"), match);
    await applyStats(match, +1);
    clearForm();
  };

  /* UPDATE MATCH */
  updateBtn.onclick = async () => {
    if(!validate()) return;

    const oldSnap = await get(window.dbRef(`matches/${editingId}`));
    const oldMatch = oldSnap.val();
    await applyStats(oldMatch, -1);

    const newMatch = {
      round:round.value,
      date:date.value,
      time:time.value,
      red:+red.value,
      blue:+blue.value,
      info:info.value.trim(),
      played:getPlayed(),
      scorers: JSON.parse(JSON.stringify(scorers)),
      timestamp: oldMatch.timestamp
    };

    await update(window.dbRef(`matches/${editingId}`), newMatch);
    await applyStats(newMatch, +1);
    clearForm();
  };

  /* DELETE MATCH */
  window.deleteMatch = async id => {
    if (!confirm("Obrisati meƒç?")) return;

    const snap = await get(window.dbRef(`matches/${id}`));
    await applyStats(snap.val(), -1);
    await remove(window.dbRef(`matches/${id}`));
  };

  /* FORMAT DATE */
  function formatDateForInput(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
  }

  /* CLEAR FORM */
  window.clearForm = function(){
    editingId = null;
    scorers = [];
    pendingPlayed = null;

    round.value = "";
    red.value = "";
    blue.value = "";
    info.value = "";
    autoFillRound();

    document.querySelectorAll(".player-btn.active").forEach(b => b.classList.remove("active"));
    refreshTags();

    const d = getNextThursday();
    date.value = formatDateForInput(d);
    time.value = "18:00";

    saveBtn.style.display = "block";
    updateBtn.style.display = "none";
    cancelBtn.style.display = "none";
  };

  /* LIST MATCHES */
  onValue(window.dbRef("matches"), snap=>{
    const tbody=document.getElementById("matchList");
    tbody.innerHTML="";

    Object.entries(snap.val()||{})
      .sort((a,b)=>b[1].timestamp-a[1].timestamp)
      .forEach(([id,m])=>{
        tbody.innerHTML+=`
          <tr>
            <td><strong>${m.round}</strong></td>
            <td>Crveni <strong>${m.red}</strong> - <strong>${m.blue}</strong> Plavi</td>
            <td>${m.date} ${m.time}</td>
            <td>
              <button class="table-btn edit" onclick="editMatch('${id}')">Izmeni</button>
              <button class="table-btn delete" onclick="deleteMatch('${id}')">Obri≈°i</button>
            </td>
          </tr>`;
      });
  });

  /* EDIT MATCH */
  window.editMatch = async matchId => {
    editingId = matchId;

    const snap = await get(window.dbRef(`matches/${matchId}`));
    const m = snap.val();

    round.value = m.round;
    date.value = m.date;
    time.value = m.time;
    red.value = m.red;
    blue.value = m.blue;
    info.value = m.info;

    scorers = [...m.scorers];
    refreshTags();

    pendingPlayed = m.played || {};
    applyPlayedSelection(pendingPlayed);

    saveBtn.style.display = "none";
    updateBtn.style.display = "block";
    cancelBtn.style.display = "block";

    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  /* AUTO THURSDAY */
  function getNextThursday() {
    const now = new Date();
    let diff = (4 - now.getDay() + 7) % 7;
    if (diff === 0) diff = 7;
    const d = new Date();
    d.setDate(now.getDate() + diff);
    return d;
  }

  (function(){
    const d = getNextThursday();
    date.value = formatDateForInput(d);
    time.value = "18:00";
    autoFillRound();
  })();

  /* AUTO ROUND */
  function autoFillRound() {
    onValue(window.dbRef("matches"), snap => {
      const data = snap.val() || {};
      const rounds = Object.values(data).map(m => Number(m.round) || 0);
      const nextRound = (rounds.length ? Math.max(...rounds) + 1 : 1);
      round.value = nextRound;
    }, { onlyOnce: true });
  }

  </script>

  </body>
  </html>
