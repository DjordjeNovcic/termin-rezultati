<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8">
  <title>Migration Tool</title>

  <script type="module">
    import { get, set, remove, update }
      from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";
    import "./firebase.mjs";

    async function migrate() {
      const playersSnap = await get(window.dbRef("players"));
      const oldPlayers = playersSnap.val() || {};

      if (!oldPlayers.crveni && !oldPlayers.plavi) {
        alert("Nema starih igraÄa za migraciju.");
        return;
      }

      const newPlayers = { crveni: {}, plavi: {} };

      console.log("Stari podaci:", oldPlayers);

      /* MIGRACIJA CRVENI */
      if (oldPlayers.crveni) {
        Object.values(oldPlayers.crveni).forEach(p => {
          const cleanName = p.name.trim();
          newPlayers.crveni[cleanName] = {
            name: cleanName,
            goals: 0,
            matches: 0
          };
        });
      }

      /* MIGRACIJA PLAVI */
      if (oldPlayers.plavi) {
        Object.values(oldPlayers.plavi).forEach(p => {
          const cleanName = p.name.trim();
          newPlayers.plavi[cleanName] = {
            name: cleanName,
            goals: 0,
            matches: 0
          };
        });
      }

      console.log("Upisujem nove podatke:", newPlayers);

      /* UPIS NOVOG FORMAT BAZE */
      await set(window.dbRef("players"), newPlayers);

      alert("Migracija zavrÅ¡ena! ğŸ‰\nSada moÅ¾eÅ¡ normalno da koristiÅ¡ admin.html");
    }

    window.onload = () => migrate();
  </script>
</head>
<body style="font-family:Arial; padding:40px;">
  <h1>MIGRATION TOOL</h1>
  <p>Migracija traje 1 sekund. Ako vidiÅ¡ alert â€“ gotovo je!</p>
  <p>Stranica radi automatski Äim se otvori.</p>
</body>
</html>
