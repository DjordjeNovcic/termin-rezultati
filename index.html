<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8">
  <title>Rezultati svih odigranih utakmica</title>
  <script type="module" src="firebase.mjs"></script>

  <style>
    body {
      font-family: Arial;
      max-width: 900px;
      margin: 20px auto;
      padding: 0 15px;
    }

    #adminBtn {
      position: fixed;
      top: 15px;
      right: 15px;
      padding: 8px 14px;
      font-size: 14px;
      border-radius: 6px;
      border: none;
      background: #0044cc;
      color: white;
      cursor: pointer;
      z-index: 99;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-size: 26px;
    }

    /* ----- MEƒå KARTICE ----- */

    .match {
      padding: 20px 12px;
      border-bottom: 1px solid #bbb;
      margin-bottom: 15px;
      border-radius: 8px;
    }

    .match.winner-red { background: #fff5f5; }
    .match.winner-blue { background: #f5f7ff; }
    .match.draw { background: #f9f9f9; }

    .meta {
      font-size: 14px;
      color: #666;
      text-align: center;
      margin-bottom: 12px;
    }

    .score-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .team {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 110px;
    }

    .team img {
      width: 70px;
      height: 70px;
    }

    .team-name {
      font-weight: bold;
      margin-top: 6px;
      font-size: 16px;
    }

    .red { color: #c00000; }
    .blue { color: #0044cc; }

    .score {
      font-size: 32px;
      font-weight: bold;
      min-width: 90px;
      text-align: center;
    }

    .score.winner-red { color: #c00000; }
    .score.winner-blue { color: #0044cc; }
    .score.draw { color: #555; }

    /* ----- COMPACT TABELA ----- */

    .table-wrapper {
      width: 100%;
      overflow-x: auto;
      margin-top: 20px;
    }

    #league {
      width: 100%;
      border-collapse: collapse;
      text-align: center;
      table-layout: fixed; /* KOMPAKTNO */
    }

    #league th {
      background: #ececec;
      padding: 6px;
      font-size: 14px;
      border-bottom: 2px solid #aaa;
      white-space: nowrap;
    }

    #league td {
      padding: 6px;
      font-size: 14px;
      border-bottom: 1px solid #ccc;
      white-space: nowrap;
    }

    #league tr:nth-child(even) td {
      background: #fafafa;
    }

    .leader-row td {
      background: #fff7d6 !important;
      font-weight: bold;
    }

    /* ----- FORMA ----- */

    #formSection { margin-top: 30px; }

    #formSection h2 {
      text-align: center;
      margin-bottom: 10px;
    }

    .form-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 4px 0;
    }

    .team-label {
      min-width: 70px;
      text-align: right;
      font-weight: bold;
    }

    .form-icons span {
      font-size: 20px;
      margin: 0 2px;
    }
  </style>
</head>
<body>

<button id="adminBtn">Admin</button>

<h1>Rezultati svih odigranih utakmica</h1>

<div id="list"></div>

<div class="table-wrapper">
  <table id="league">
    <thead>
      <tr>
        <th>Tim</th>
        <th>Utakmice</th>
        <th>Pobede</th>
        <th>Nere≈°eno</th>
        <th>Porazi</th>
        <th>G. dati</th>
        <th>G. primljeni</th>
        <th>G. razlika</th>
        <th>Bodovi</th>
      </tr>
    </thead>
    <tbody id="leagueBody"></tbody>
  </table>
</div>

<div id="formSection">
  <h2>Forma poslednjih 5 meƒçeva</h2>
  <div class="form-row">
    <span class="team-label red">Crveni</span>
    <span id="formCrveni" class="form-icons"></span>
  </div>
  <div class="form-row">
    <span class="team-label blue">Plavi</span>
    <span id="formPlavi" class="form-icons"></span>
  </div>
</div>

<script type="module">
import { onValue } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

const ref = window.dbRef("matches");

onValue(ref, snap => {
  const data = snap.val() || {};
  const list = document.getElementById("list");
  list.innerHTML = "";

  const matches = Object.values(data).sort((a,b)=>b.timestamp - a.timestamp);

  /* MEƒåEVI */
  matches.forEach(m => {
    const isRedWin = m.red > m.blue;
    const isBlueWin = m.blue > m.red;
    const isDraw = m.red === m.blue;

    const cardClass = isDraw ? "draw" : isRedWin ? "winner-red" : "winner-blue";
    const scoreClass = isDraw ? "draw" : isRedWin ? "winner-red" : "winner-blue";

    list.innerHTML += `
      <div class="match ${cardClass}">
        <div class="meta">
          Kolo <b>${m.round}</b> ‚Äì ${m.date} u ${m.time}
        </div>

        <div class="score-wrapper">
          <div class="team">
            <img src="crveni.png">
            <div class="team-name red">Crveni</div>
          </div>

          <div class="score ${scoreClass}">
            ${m.red} - ${m.blue}
          </div>

          <div class="team">
            <img src="plavi.png">
            <div class="team-name blue">Plavi</div>
          </div>
        </div>
      </div>`;
  });

  /* TABELA */
  function calculateTable(matches) {
    const table = {
      Crveni: { U:0, P:0, N:0, I:0, GD:0, GP:0, GR:0, B:0 },
      Plavi:  { U:0, P:0, N:0, I:0, GD:0, GP:0, GR:0, B:0 }
    };

    matches.forEach(m=>{
      let r=m.red, b=m.blue;
      table.Crveni.U++; table.Plavi.U++;
      table.Crveni.GD+=r; table.Crveni.GP+=b;
      table.Plavi.GD+=b; table.Plavi.GP+=r;

      if(r>b){ table.Crveni.P++; table.Plavi.I++; table.Crveni.B+=3; }
      else if(b>r){ table.Plavi.P++; table.Crveni.I++; table.Plavi.B+=3; }
      else { table.Crveni.N++; table.Plavi.N++; table.Crveni.B++; table.Plavi.B++; }
    });

    table.Crveni.GR = table.Crveni.GD - table.Crveni.GP;
    table.Plavi.GR  = table.Plavi.GD - table.Plavi.GP;

    return table;
  }

  function renderTable(table){
    const body=document.getElementById("leagueBody");
    body.innerHTML="";

    let leader = table.Crveni.B > table.Plavi.B ? "Crveni" : "Plavi";

    ["Crveni","Plavi"].forEach(team=>{
      const t=table[team];
      body.innerHTML += `
        <tr class="${team===leader?'leader-row':''}">
          <td><b>${team}</b></td>
          <td>${t.U}</td>
          <td>${t.P}</td>
          <td>${t.N}</td>
          <td>${t.I}</td>
          <td>${t.GD}</td>
          <td>${t.GP}</td>
          <td>${t.GR}</td>
          <td>${t.B}</td>
        </tr>`;
    });
  }

  const table = calculateTable(matches);
  renderTable(table);

  /* FORMA */
  function calculateForm(matches){
    const c=[],p=[];
    matches.forEach(m=>{
      if(m.red>m.blue){ c.push("W"); p.push("L"); }
      else if(m.red<m.blue){ c.push("L"); p.push("W"); }
      else { c.push("D"); p.push("D"); }
    });
    return {
      Crveni:c.slice(0,5),
      Plavi:p.slice(0,5)
    };
  }

  function renderForm(form){
    const map={W:"üü¢",D:"üü°",L:"üî¥"};
    document.getElementById("formCrveni").innerHTML =
      form.Crveni.map(x=>`<span>${map[x]}</span>`).join("");

    document.getElementById("formPlavi").innerHTML =
      form.Plavi.map(x=>`<span>${map[x]}</span>`).join("");
  }

  renderForm(calculateForm(matches));
});
</script>

<script>
  const btn=document.getElementById("adminBtn");
  function refreshBtn(){
    const isAdmin=localStorage.getItem("admin")==="1";
    if(isAdmin){
      btn.innerText="Admin panel";
      btn.onclick=()=>window.location.href="admin.html";
    } else {
      btn.innerText="Login";
      btn.onclick=()=>window.location.href="login.html";
    }
  }
  refreshBtn();
</script>

</body>
</html>
